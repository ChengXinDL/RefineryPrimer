# Workflow 2 : Building positionning based on solar analysis

<p align="center">
  <img src="https://media.giphy.com/media/kDNLpoOjcxV96gOa2P/giphy.gif">
</p>

## Description

The graph will iterate the position and rotation of the selected tower design, so it falls within the site boundary while minimizing the Solar Indicence by Area ratio.

To avoid options that don't comply (outside of site boundary), the results are heavily penalized, saving computational time by making the analysis to fail on purpose.

## Inputs

| Dynamo Input          | Input Description |
| :--- | :--- |
| Site boundary         | Select the site boundary lines from the Revit model |
| Surrounding buildings | Select the surrounding constructions that will affect the proposed building location |
| Main building         | Select the building that will relocated based on solar analysis |
| Site offset           | Give the site boundary an offset to limit the building movement inside the boundary |
| Floor height          | Average floor to floor height used on the solar analysis |
| Location coordinates  | Specify the building real world coordinates for the solar analysis |

| Refinery Input    | Input Description |
| :--- | :--- |
| Building rotation | Angle between 0° and 360° that will rotate the building from its initial position |
| U value           | U parameter from the site surface where the building will be located |
| V value           | V parameter from the site surface where the building will be located |

## Functions

The script is made up of a series of functions, which are divided into groups inside the graph. Each group has a name and a short description, where the name indicates the type of funciton that is being run and the description explains a bit more in detail the process.
This graph is taking the main building and converting it into dynamo geometry. It also takes all the surrounding buildings that are higher than 30m and converting them into dynamo geometry as well. Then it retrieves the mid point at the base of the main building it moves based on the U and V values and it rotates it based on the input angle. With the new location, a solar analysis is carried out for all the external vertical surfaces of the building. With the final result from the analysis the outputs are calculated.

## Visualization

All unnecesary geometry has been hidden from the graph in order to get a nice visual in the Refinery interface. Only the main building and the solar analysis will be visible. The solar analysis is represented on the external surfaces of the building. A grid of points in every surface is coloured based on the results from the analysis following a range from yellow to red. Yellow indicates low sun incidence and red high incidence. This will make easy the task of visually going through the options generated by the graph. For a better understanding of the results, a series of context buildings have been inluded in the Revit sample file.

## Outputs

| Refinery Output   | Output Description |
| :--- | :--- |
| Area out          | Area of the building in square meters that is outside of the site boundary |
| Free area         | Area of the construction site in plan that is not occupied by the building |
| Average incidence | Incidence in square meters into the external walls of the building |

## Refinery

This graph can be used in combination with refinery to iterate through a series of inputs calculating the best position for a maximum solar incidence over the external surfaces of the building.
This specific script is prepared to be used with optimizing studies. 
One of the caveats of the script is the site offset. Big offset values help refinery to get optimal solutions where the entire building is inside of the site boundary. Otherwise, the movement allowance of the building will be so large that it will take refinery big populations to get an optimal solution without getting out of the site boundary.
Design options where the building is outside of the site boundary have been penalized in the script. They will still show the resultant outputs, but the building visual won't show the solar incision in the external walls.

## Results

Once Refinery has finish running we can have a look at the outputs of the new study.
This specific example was obtined from an optimized study based on 10 generations with a population of 20. 
<br>
Regarding the outputs, the building area outside of the site boundary ***OUT_Area Out(m2)*** and the solar incidence on the external cladding ***OUT_Avg. (kWh/m2)*** are set to minimized, that will keep the building within the site boundary. 
<br>
The last output, area of the site not occupied by the building ***OUT_Free Area (m2)*** can be ignored, as this value will allways be the same while the building is inside the site perimeter.
![IMAGE](Images/07-02_Workflow_2//7-02_workflow2_optimisationrun.png)
